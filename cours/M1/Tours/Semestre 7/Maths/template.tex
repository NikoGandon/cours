\documentclass[11pt,a4paper]{article}

% Packages essentiels
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[french]{babel}
\usepackage{lmodern}
\usepackage[margin=2.5cm,top=3cm]{geometry}

% Mathématiques avancées
\usepackage{amsmath,amssymb,mathtools,amsthm}
\usepackage{cancel}  % Pour les barrages dans les calculs

% Couleurs et graphiques
\usepackage{xcolor}
\definecolor{mathbg}{RGB}{245,248,252}      % Fond bleu très clair pour les formules
\definecolor{mathdisplay}{RGB}{240,245,250} % Fond pour les équations display
\definecolor{sectioncolor}{RGB}{0,51,102}   % Bleu foncé pour les titres
\definecolor{subsectioncolor}{RGB}{0,102,204} % Bleu moyen

% Boîtes colorées pour formules importantes
\usepackage{tcolorbox}
\tcbuselibrary{most,skins,breakable}

% Boîte pour les équations importantes
\newtcolorbox{importantbox}{
  colback=yellow!5!white,
  colframe=orange!75!black,
  fonttitle=\bfseries,
  title=Formule importante,
  arc=2mm,
  boxrule=1pt,
  breakable
}

% Boîte pour les résultats
\newtcolorbox{resultbox}{
  colback=green!5!white,
  colframe=green!50!black,
  fonttitle=\bfseries,
  title=Résultat,
  arc=2mm,
  boxrule=1pt,
  breakable
}

% Amélioration du rendu des équations display
\usepackage{empheq}
\usepackage[framemethod=TikZ]{mdframed}

% Fond coloré pour les équations en mode display
\definecolor{eqnbg}{RGB}{248,249,250}
\newmdenv[
  backgroundcolor=eqnbg,
  linewidth=0pt,
  innertopmargin=8pt,
  innerbottommargin=8pt,
  skipabove=12pt,
  skipbelow=12pt,
  roundcorner=3pt
]{eqnbox}

% En-têtes personnalisés
\usepackage{fancyhdr}
\usepackage{lastpage}
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\small\textsc{$title$}}
\fancyhead[R]{\small Page \thepage/\pageref{LastPage}}
\fancyfoot[C]{\small $author$ -- $date$}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0.5pt}

% Style des titres avec meilleur contraste
\usepackage{titlesec}
\titleformat{\section}
  {\normalfont\LARGE\bfseries\color{sectioncolor}}
  {\thesection}{1em}{}[\titlerule]
\titleformat{\subsection}
  {\normalfont\Large\bfseries\color{subsectioncolor}}
  {\thesubsection}{1em}{}
\titleformat{\subsubsection}
  {\normalfont\large\bfseries\color{subsectioncolor!80!black}}
  {\thesubsubsection}{1em}{}

% Espacement optimisé pour les maths
\setlength{\parskip}{0.8em}
\setlength{\parindent}{0pt}
\linespread{1.2}
\renewcommand{\arraystretch}{1.4}  % Plus d'espace dans les matrices

% Espacement autour des équations (plus d'air)
\AtBeginDocument{%
  \abovedisplayskip=15pt plus 4pt minus 8pt
  \belowdisplayskip=15pt plus 4pt minus 8pt
  \abovedisplayshortskip=10pt plus 3pt minus 5pt
  \belowdisplayshortskip=10pt plus 3pt minus 5pt
}

% Amélioration des matrices avec plus d'espace
\makeatletter
\renewcommand*\env@matrix[1][\arraystretch]{%
  \edef\arraystretch{#1}%
  \hskip -\arraycolsep
  \let\@ifnextchar\new@ifnextchar
  \array{*\c@MaxMatrixCols c}}
\makeatother

% Séparateurs visuels élégants
\newcommand{\separator}{%
  \vspace{0.5em}
  \noindent\textcolor{gray!50}{\rule{\textwidth}{0.4pt}}
  \vspace{0.5em}
}

% Liens avec bon contraste
\usepackage[colorlinks=true,linkcolor=blue!70!black,urlcolor=blue!80!black,citecolor=blue!70!black]{hyperref}

\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\providecommand{\passthrough}[1]{#1}

\begin{document}

%% Page de titre
%\begin{titlepage}
%\centering
%\vspace*{2cm}
%{\Huge\bfseries $title$ \par}
%\vspace{1cm}
%{\Large $author$ \par}
%\vspace{0.5cm}
%{\large $date$ \par}
%\vfill
%{\large Master 1 -- Mathématiques\par}
%{\large Université de Tours\par}
%\end{titlepage}
%
%$if(toc)$
%\tableofcontents
%\newpage
%$endif$

$body$

\end{document}
